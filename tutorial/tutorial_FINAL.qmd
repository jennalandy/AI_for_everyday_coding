---
title: "AI for Everyday Coding"
subtitle: "Part 2-3: GitHub Copilot for Data Analysis and Visualization in Rstudio and VS Code"
author: "Jenna Landy"
date: "2025-12-10"
output:
  html_document:
    toc: true
    toc_depth: 2
    number_sections: false
    theme: united
editor: 
  markdown: 
    wrap: 72
---

```{r message=FALSE}
library(readr)
library(tidyverse)
library(ggplot2)
library(janitor)
library(ggrepel)
library(ggh4x)
library(patchwork)
library(glue)

source("4_data_funcs.R")
source("4_viz_funcs.R")
```

## Part 1: Chat GPT for Data Access and Literature Review

I've extracted relevant code from Part 1, but for convenience, have removed all queries and responses.

```{r}
resp <- httr::GET(
  url = "https://data.cdc.gov/resource/8xkx-amqh.csv",
  query = list(
    "$select" = "*",
    "$where"  = "recip_state = 'CA' AND date BETWEEN '2021-01-01' AND '2021-12-31'",
    "$limit"  = "500000"
  )
)

httr::stop_for_status(resp)

data <- readr::read_csv(httr::content(resp, as = "raw"), show_col_types = FALSE)
```

## Part 2: Data filtering and algorithm development with GitHub Copilot in VS Code

::: callout-tip
GitHub Copilot provides AI suggestions that can be implemented by pressing `tab`. It works best if you include a comment of what you're trying to do, then start to write your code (e.g., first line of tidyverse `data %>%`).

In VS Code, GitHub copilot has a chat function with the context of whatever file you're working on. The chat is more powerful to create large chunks of code or answer questions about specific functions or errors.
:::

### a. Processing data

```{r}
# identify counties with all zeros
zero_counties <- data %>%
  group_by(recip_county) %>%
  summarize(max_pct = max(series_complete_pop_pct, na.rm = TRUE)) %>%
  filter(max_pct == 0) %>%
  pull(recip_county)

# filter out unknown and zero counties
data_filtered <- data %>%
    filter(
        recip_county != "Unknown County",
        !recip_county %in% zero_counties
    ) %>%
    # reduce only to columns we'll use (date, fips, recip_county, series_complete_pop_pct)
    select(date, fips, recip_county, series_complete_pop_pct) %>%
    # rename series_complete_pop_pct to pct for ease of use
    rename(pct = series_complete_pop_pct) %>%
    arrange(recip_county, date)

# identify unique counties
counties <- data_filtered %>% pull(recip_county) %>% unique()

# print counties separated by commas
cat(paste0(counties, collapse = ", "))
```

### b. Code from pseudocode

In this section, we'll use local linear regression to estimate derivatives (see [Brabanter et al. 2013](https://jmlr.csail.mit.edu/papers/volume14/debrabanter13a-deleted/debrabanter13a.pdf) for an overview of these types of methods). Basically, we estimate $\partial y/\partial x$ at a point $x_i$ with the slope of a linear regression on a set of points symmetric around $x_i$: $i-w,...,i,...,i+w$, where width $w$ is a parameter of the function.

::: {style="background-color: #B3E5FC;"}
**Query** {{< fa search >}}

Write a function that takes in vectors y and x and returns the approximate derivative dy/dx evaluated at each point $x_i$. For a value $x_i$, I want to do this by getting the linear regression coefficient using w points on either side ($x_{i-w} : x_{i+w}$), where width w can be a parameter of the function. Use a default w = 40.
:::

::: {style="background-color: #C8E6C9;"}
**Reply** {{< fa robot >}}
See `4_data_funcs.R` for the function.
:::

### c. Manipulating data

```{r}
# using an example county
county = "Santa Cruz County"

# turn it into a function
county_curve(county)
```


## Part 3: Data visualization with GitHub Copilot in RStudio

::: callout-tip
Rstudio does not offer the chat functionality, but it still offers code completion. This a good starting point for users who are most comfortable with RStudio and only want to test out one new tool at a time.

RStudio already has some default code completion that can compete with Copilot's suggestions. This means that pressing `tab` may not always implement Copilot's suggestions. To avoid this, you can disable the RStudio completions in Settings > Code > Completion > Show code completions: "Never".
:::

### a. Visualizing data

```{r}
# for an example county
county = "Santa Cruz County"

# turn it into a function
plot_county_curve(county)
plot_county_curve("San Luis Obispo County")
```

### b. Offloading repetitive tasks

```{r}
# for an example county
county = "Santa Cruz County"

# turn it into a function
t(curve_metrics(county))
plot_county_curve(county)
```

### c. Exploratory data analysis (EDA)

```{r}
# run county_curve_metrics on all counties and use each
# output as a row in a matrix
county_metrics_list <- lapply(counties, curve_metrics)
county_metrics <- do.call(rbind, lapply(county_metrics_list, data.frame))

# turn into dataframe with correct column types(county as character, start and stop as dates, rest as numeric)
county_metrics_df <- data.frame(county_metrics) %>%
    mutate(
        county = as.character(county),
        start = as.Date(start),
        stop = as.Date(stop),
        duration = as.numeric(duration),
        start_pct = as.numeric(start_pct),
        stop_pct = as.numeric(stop_pct),
        pct_increase = as.numeric(pct_increase),
        avg_slope = as.numeric(avg_slope),
        max_pct = as.numeric(max_pct)
    )
head(county_metrics_df)
```

```{r}
# plot date where speedup began vs slope of rapid vaccination phase
county_metrics_df %>%
    ggplot(aes(x = start, y = avg_slope)) +
    geom_point() +
    # label points with county names with repelling
    geom_text_repel(aes(label = county), size = 1.5) +
    # simple theme without grey background 
    theme_bw()
```

```{r}
# investigate interesting counties from previous plot
plot_county_curve("Lassen County", deriv = FALSE)
plot_county_curve("Marin County", deriv = FALSE)
plot_county_curve("Merced County", deriv = FALSE)
```

```{r}
# derivative of pct with respect to date for all counties
approx_derivative(data_filtered$pct, as.numeric(data_filtered$date))
```

## Part 4: Refactoring with Cursor

## Part 5: Agentic AI with Cursor
